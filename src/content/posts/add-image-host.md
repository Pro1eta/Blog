---
title: Cloudflare R2 对象存储 + Piclist 实现图床
published: 2025-07-22
description: ''
image: ''
tags: ['Blogging']
category: '流程'
draft: false 
pinned: false
lang: 'zh_CN'
series: ''
---

## 购买并配置 R2

### 购买 R2 对象存储服务

将图片全部存在本地不利于博客迁移，赛博善人 [Cloudflare](https://www.cloudflare-cn.com/) 提供了 R2对象存储服务，并且有大量的免费额度，对访问量低、存储量少的个人站点来说完全够了。

购买需要信用卡信息，如果你只有借记卡，当然也可以像我一样选择注册大陆 Paypal（尽管这东西没什么用）。

![517907e74dbe5caf26ea53dbef95f293 1764958502709 1|618x353](https://image.proleta.org/2025/12/517907e74dbe5caf26ea53dbef95f293-1764958502709-1.webp)

接下来创建存储桶，名称随意，位置按照你的需求选择，如果访问群体主要来自亚洲，就选择亚太。默认存储类选择**标准**。

![ec1319481b363230198c2047aaa806c9 1764958505608 4|618x187](https://image.proleta.org/2025/12/ec1319481b363230198c2047aaa806c9-1764958505608-4.webp)

启用 `公共开发 URL` 之后，就可以在对象界面上传并添加文件了，我们点击上传的图片。

![01092288e4130143fdc91329a168ea57 1764958507792 7|618x313](https://image.proleta.org/2025/12/01092288e4130143fdc91329a168ea57-1764958507792-7.webp)

你就可以获得公共开发 URL，复制，然后就可以在你的 Markdown 文件之中引用它。比如这是**立希的大头照**。

![abe9c65e28ced7934483d93e5e5309ea 1764958509572 10|618x359](https://image.proleta.org/2025/12/abe9c65e28ced7934483d93e5e5309ea-1764958509572-10.webp)

### 自定义域名

**Cloudflare** 的公共开发 URL 限制速率，接下来你可以添加 `自定义域`，使用你准备好的域名即可，接下来按照提示操作。添加自定义域之后，原来的 `公共开发 URL ` 可以关掉。

![7f3f3db6cef7c392b211d8d32cafaf1f 1764958511815 13|493x374](https://image.proleta.org/2025/12/7f3f3db6cef7c392b211d8d32cafaf1f-1764958511815-13.webp)

### 安全性

一般说来个人网站之类的小站点没什么攻击的价值...根据CF的收费，被刷之后产生的账单谈不上有多高。关于防刷流量参见 [这篇文章](https://zhuanlan.zhihu.com/p/1899044076168394425)。以下内容全部在图床域名设置。

| 类别    | 内容       | 免费额度                | 超出部分费用        |
| ----- | -------- | ------------------- | ------------- |
| 存储    | 存储空间     | 10GB/月 免费可存5万张2MB图片 | 1GB / $0.015  |
| A 类操作 | 上传、列出    | 100 万次/月 免费每天3.3万次  | 100 万次/$4.50  |
| B 类操作 | 下载、读取    | 1000 万次/月 免费每天33万次  | 1000 万次/$0.36 |
| 出口流量  | 访问数据时的流量 | 全免                  | 无任何费用         |

#### 设置图片缓存规则

因为要进行`页面规则`的设置，给 R2 的域名**最好不要**解析到你的站点服务器。

![d7b6eddbae68d04ae922a162d255c7a9 1764958515562 16|618x291](https://image.proleta.org/2025/12/d7b6eddbae68d04ae922a162d255c7a9-1764958515562-16.webp)

配置参考：

比如我的域名（用于R2的）是 1mag3.cn，那么我的配置就是：

- URL：https://1mag3.cn/*
- 浏览器缓存 TTL：1天
- 边缘缓存 TTL：1个月（如果更新勤快，可以适当降低）
- 缓存级别：所有内容
- 源服务器缓存控制：添加但不开启。这样缓存规则就会由 Cloudflare 控制。

浏览器缓存指的是访问网站时，浏览器会将某些网站资源（如图片、样式表、脚本等）存储在本地硬盘上，1天就表示缓存1天，下次访问的时候不必再向服务器请求。边缘缓存就是 CDN 的缓存。

#### 速率限制

选择 `安全性` -> `WAF`  -> `速率限制规则` -> `创建规则`。

![8ac72ae06ddd66d69ab0c71d50410fe8 1764958519513 19|618x780](https://image.proleta.org/2025/12/8ac72ae06ddd66d69ab0c71d50410fe8-1764958519513-19.webp)

其中：

- 规则名称：随意
- 字段：URL路径、包含、/
- 当速率超过...：400，10秒钟
- 然后采取措施…：阻止

这里重点是 `当速率超过...` 这个选项，推荐100甚至更多一点，不建议填写太低，很容易误伤；意思是同一个 IP 10 秒内请求超过多少张图片，就触发操作。比如我设置为200。

#### 防盗链

选择 `安全性` -> `WAF`  -> `自定义规则`。

- 主机名：等于，图床域名

- And：右边添加一个 And

- 引用方：不等于，你的博客域名

- 然后采取措施...：阻止

![c8c27ce7f51db9c96b5359bb877de30b 1764958530558 22](https://image.proleta.org/2025/12/c8c27ce7f51db9c96b5359bb877de30b-1764958530558-22.webp)

如果在浏览器直接访问，发现图片防盗链是成功的。

:::caution
防盗链设置也会让你在本地无法正常使用外链显示图片！因此建议完成博客写作后再统一上传图片，或者做好备份。
:::

## 用 Piclist 上传图片

无论是用 Typora，VS code 还是什么文本编辑器写作。[Piclist](https://piclist.cn/) 可以优化一张张图片手动上传的麻烦...

如果你和我一样使用 Ubuntu 22.04 等，运行 Piclist （.Appimage）前需要先安装依赖。

```shell
sudo apt update
sudo apt install libfuse2
```

为 `.Appimage` 文件设置可执行权限之后，双击运行即可。我们先在 CF 创建 API 令牌。

![75a8ebd4814f673545ad749f06430225 1764958535690 25](https://image.proleta.org/2025/12/75a8ebd4814f673545ad749f06430225-1764958535690-25.webp)

选择 `账户 API` 令牌即可，我的配置如下：

![47db6227d4b9dd88d25b580a305dbcba 1764958537799 28](https://image.proleta.org/2025/12/47db6227d4b9dd88d25b580a305dbcba-1764958537799-28.webp)

成功创建令牌之后，**妥善保管**下一页面给出的访问密钥ID，机密访问密钥等内容。接下来我们打开 Piclist。

在 `图床` -> `AWS S3` 中配置设置。

![d3f0f60cefdde993c897751d95a41609 1764958539651 31](https://image.proleta.org/2025/12/d3f0f60cefdde993c897751d95a41609-1764958539651-31.webp)

- `AccessKeyID` 填之前创建 API 令牌时获得的访问密钥 ID。
- `SecretAccessKey`填之前创建 API 令牌时获得的机密访问密钥。

- `Bucket`填之前的存储桶的名称

- `上传路径` 按照个人喜好填写，会影响最后生成的图片外链
	`权限`填 public-read
	`地区`填 auto

- `自定义节点`填`https://<帐户 ID>.r2.cloudflarestorage.com`，可以在下图中获得：

![2123d8c3906c900ea4dd5627753b789f 1764958544042 34](https://image.proleta.org/2025/12/2123d8c3906c900ea4dd5627753b789f-1764958544042-34.webp)

- `自定义域名` 即你用作图床的域名。

	现在你可以尝试拖拽图片上传，如果要接入 Typora，在 Typora 选择：`文件` -> `偏好设置` ->`图像` -> `上传服务设定` 。进行设置即可。
	
	由于各种各样的 Bug，Typora 在设置界面有可能验证失败，但仍然是可以正常上传的。

### 验证

本文所有图片**都使用外链**。

